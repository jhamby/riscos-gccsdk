<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head><title>GCCSDK Project - Autobuilder Packaging</title></head>
<body>

<hr>

<h2>Autobuilder Packaging</h2>

<p>Copyright 2008, GCCSDK Developers</a>.</p>
<p>Last updated - 4 Jan 2008</p> 

<hr>

<p></p>

<p>
Packaging in the autobuilder at its simplest level is the creation
 of a zip file to distribute an application or library.
</p>

<h3>Creating a simple package</h3>

<p>
To create a simple package like this you need to modify the setvars bash script to define the category for the package and create an ab_package script function that copies the files to a given directory. The autobuilder itself will then zip up the directory giving it a name based on the application/library name, its upstream version and an autobuilder version.
</p>

<p>
To create a category you need to set the variable AB_CATEGORY to the name of the category this application/program applies to. e.g. Library, Audio, Graphics.
</p>
<p>
No packaging occurs unless you create your own version of the ab_package script function. Before this function is called three useful script variables are created.
</p>

<ul>
  <li>$S the directory containing the source code that has been compiled.</li>
  <li>$D the destination directory where the files to be packaged should be copied</li>
  <li>$H the autobuilder directory for this package.</li>
</ul>

<p>Creating the package is just a matter of copying files from $S and $H to $D.</p>

<p>
If the package is changed when the upstream version of the sources hasn't the variable AB_ROVERSION should be defined with a value greater than 1. It defaults to 1 if omitted.
</p>

<p>
The final zip file will be called <i>autobuilder_name</i>-<i>upstream_version</i>-<i>autobuilder_version</i>.zip
 and will be placed in the autobuilder_packages directory in the autobuilder
 in a subdirectory with the name of the category. The default name given by the autobuilder can be overridden.
</p>
<p>
More details of the variables/functions that can be defined can be seen in the setvars-template file.
</p>

<h3>Packaging for the autobuilder website</h3>

<p>
A website that contains packages from the autobuilder has been created. The long term goal is to have the autobuilder run every few months to rebuild the packages and place them on a website where they can be downloaded. Currently the site is built manually, but the framework is in place to move to automatic building.
</p>
<p>
The autobuilder website is located at:
</p>
<p> <a href="http://www.riscos.info/packages">http://www.riscos.info/packages</a>
</p>
<p>
The packages for this website need to be created in the format for the RISC OS Packaging Project (riskpkg)
 <a href="http://www.riscpkg.org">http://www.riscpkg.org</a>.
This will allow users to use RiscPkg to check for and download the application/libraries, updates and any dependencies easily.
</p>
<p>
This does not stop people who don't want to use the packaging project from using the website. The packages are all zip files that can be downloaded directly and the application/library can easily be extracted from them.
</p>
<p>
To create a package in this format requires a few relatively minor modifications to a simple ab_package script function. If the package is not downloaded from Debian a little more work is required to set up the RiscPkg control and copyright files.
</p>
<p>
The main difference is that the files to be packaged must now be copied to a subdirectory of the destination directory. This will specify the default location for the package on the user's hard disc.
In most case this would be in a subdirectory of a directory called Apps. e.g. Apps/Library for libraries.
</p>
<p>
After this directory has been added the control records required for riscpkg need to be added. A helper script called add-riscpkg has been created in the autobuilder directory that can create these records.
</p>
<p>
It has various command line options to configure the control records. The main thing needed is to specify the dependencies the application/library needs to be able to be used. For most packages you will only need to use -unixlib to specify that it uses the shared unix library, -unixhome if it saves settings to the !UnixHome application and -unixsound if the application uses the unixlib sound driver.
</p>
<p>
The riscpkg website has more details on how an application needs to be set out. Here are a few simple pointers:
</p>
<ul>
<li>The application/Library needs to be in a RISC OS application directory.</li>
<li>Command line utilities should define path variables and aliases to the command.</li>
<li>!Boot files (if used) should only set variables and aliases if they are not already set.</li>
<li>The !Run file should force the value of any variables.</li>
</ul>
<p>
A few hints about using the add-riscpkg script:
</p>
<ul>
<li>Call add-riscpkg with $AB_HOME/add-riscpkg at the end of your ab_package script function.</li>
<li>Define any additional dependencies by using -depends <dependency_name> for each dependency.</li>
<li>The description picked up from the Debian information will be most accurate if the package name matches the debian name. The easiest way to do this is to define AB_ZIPNAME to the package name you want at the beginning of the setvars script and to add -package $AB_ZIPNAME to the add-riscpkg call.</li>
<li>The current version of add-riscpkg can only create the variable entries correctly by replacing &lt;Obey$Dir&gt;, so you will need to use &lt;Obey$Dir&gt; explicitly rather than a variable set to &lt;Obey$Dir&gt; in the !Boot file.</li>
</ul>

<p>
Even if the source is not from Debian the add-riscpkg will create a most of the riscpkg file for you.
</p>
<p>
At a minimum you will probably needs to create a directory called "RiscPkg" in the packages autobuilder home directory. In this you will need to add a text file called "Control" with the Description entry in it. See the riscpkg site for the format of the description. All other fields will be generated by add-riscpkg.
</p>
<p>
You will also need to create a file called "Copyright" with the copyright details in it. add-riscpkg has another parameter called -copyrightfile that you can give the name of a copyright file in the source that can be used if a suitable file exists.
</p>

<h3>Multiple Packages</h3>
<p>
Multiple packages can be created from a single autobuilder file. To do this you need to define an AB_PACKAGES variable that contains a space separated list of the package names at the start of the setvars script. In the ab_package script function you then create each of the packages in a subdirectory with the same name of as the package.
</p>
<p>
If the packages need to have different categories add the -section <section_name> parameter to the call to add-riscpkg for the package(s) that do not go into the AB_CATEGORY section.
</p>

</body>
</html>
