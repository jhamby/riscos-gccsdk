# Configuration file for CPPUnit under autobuilder
#

AB_CATEGORY=develop

# Sources are fetched from sourceforge
#AB#_URL=http://kent.dl.sourceforge.net/sourceforge/cppunit/cppunit-1.12.0.tar.gz

# RISC OS Version of the package
AB_ROVERSION=1.0

# Flags to pass to configure in addition to those added by the configure
# wrapper.
AB_CONFLAGS="--prefix=`pwd`/cppunit --disable-test-plugin"

# Run "make install" (in fact: make $AB_INSTALLTARGET) after build
AB_INSTALL=yes

# Use this target as make target to install after build
AB_INSTALLTARGET=install

# Package function
#
# You will need to define this to do your packaging.  Its job
# is simply to copy files from the source directory ($S) or package
# script directory ($H) to the destination directory ($D)
#
ab_package () {
  cp -r $H/\!CppUnit $D
  cp -r $S/doc/html $D/\!CppUnit
  cp -r $S/include/cppunit $D/\!CppUnit
  find $D/\!CppUnit/cppunit -name "Makefile*" -exec rm {} \;
  find $D/\!CppUnit/cppunit -noleaf -type d -not -name "h" -exec mkdir {}/h \;
  find $D/\!CppUnit/cppunit -exec rename 's/(.+)\/(.+)\.(.+)/$1\/$3\/$2/' {} \;
  mkdir -p $D/\!CppUnit/a
  cp `pwd`/cppunit/lib/libcppunit.a $D/\!CppUnit/a/libcppunit

  mkdir -p $D/RiscPkg
  #cpp -P -DROVERSION=$AB_ROVERSION $H/RiscPkg/Control $D/RiscPkg/Control
  #cpp -P -DAUTHORS="`cat $S/AUTHORS`" $H/RiscPkg/Copyright $D/RiscPkg/Copyright
  cat $H/RiscPkg/Control | sed s/ROVERSION/$AB_ROVERSION/ > $D/RiscPkg/Control
  echo sed "/AUTHORS/ {r $S/AUTHORS d}"
  cat $H/RiscPkg/Copyright | sed "/AUTHORS/ {
                                             r $S/AUTHORS
                                             d
                                            }" > $D/RiscPkg/Copyright
  cat $S/COPYING >> $D/RiscPkg/Copyright
}

# Finally, as this file is executed as a bash script, you can place other
# commands in here.  These will be executed after unpack of the source
# and application of any patches, but before any configuration or build.

mkdir -p $D/include/cppunit/extensions $D/include/cppunit/plugin $D/include/cppunit/config
mkdir -p $D/include/cppunit/tools $D/include/cppunit/portability
mkdir -p $D/include/cppunit/ui/text $D/include/cppunit/ui/mfc $D/include/cppunit/ui/qt

