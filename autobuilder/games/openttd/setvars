AB_MAINTAINER="Peter Naulls <peter@chocky.org>"                                                                    
AB_LICENCE="GPLv2"

(unset CC; unset CXX; ./configure)
make -C objs/lang

rm config.cache
cp objs/lang/endian_check objs/release
cp $H/endian_host.h objs/release

cp -av $H/riscos os

$CC -I$GCCSDK_INSTALL_ENV/include -I$GCCSDK_INSTALL_ENV/include  $GCCSDK_INSTALL_ENV/lib/libOSLib32.a \
 os/riscos/frontend.c os/riscos/rev.c -O2 -o frontend$AB_EXEEXT


export CFLAGS=-I/home/riscos/env/include
AB_CONFLAGS="--os=unix --with-zlib=$GCCSDK_INSTALL_ENV/lib/libz.a --prefix-dir=/OpenTTD:
             --data-dir= --without-shared-dir --personal-dir=/OpenTTDChoices:/ --with-freetype=0 --with-fontconfig=0"

ab_package () {
  ab_create_app OpenTTD Apps/Games

  cp -av $S/bin/data/*.grf $A/data/
  cp -av $S/bin/data/*.dat $A/data/
  cp -av $S/bin/data/*.obg $A/data/
  #cp -av $S/bin/data/*.obs $A/data/
  cp -av $S/bin/scripts    $A/

  for doc in docs/Manual.txt docs/multiplayer.txt COPYING known-bugs.txt readme.txt; do
    cp -av $S/$doc $A/docs/
  done

  cat readme.txt >> $A/\!Help

  cp -av $S/bin/lang/*.lng $A/lang/

  cp -av $S/frontend$AB_EXEEXT $A/Resources/Installer/\!RunImage$AB_EXEEXT
  cp -av $S/objs/release/openttd $A/\!RunImage$AB_EXEEXT

  $AB_HOME/add-riscpkg -unixlib
}
