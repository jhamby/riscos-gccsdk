AB_CATEGORY=Command

# The RISC OS patches are against zip 3.0 which is not yet in Debian unstable, so direct fetching:
AB_URL=ftp://ftp.info-zip.org/pub/infozip/src/zip30.tgz

AB_ROVERSION=001

AB_PRECONF=:

# We're using SCL so extension is always ,ff8.
AB_MAKE="$AB_MAKE CC=arm-unknown-riscos-gcc E=,ff8"

cp $S/acorn/GMakefile $S/Makefile

ab_package() {
  ab_create_command_app zip Apps/Utilities
  # We're using SCL so use ,ff8 instead of $AB_EXEEXT
  ab_add_commands $S/*,ff8
  test ! -f $S/acorn/zipsfx || mv $S/acorn/zipsfx $S/acorn/zipsfx,feb
  ab_add_commands $S/acorn/zipsfx,feb

  echo "Filer_OpenDir <Obey\$Dir>.docs" > $A/\!Help,feb

  # Copy documentation:
  mkdir $A/docs
  rman -f HTML $S/man/zip.1 > $A/docs/zip,faf
  rman -f HTML $S/man/zipcloak.1 > $A/docs/zipcloak,faf
  rman -f HTML $S/man/zipnote.1 > $A/docs/zipnote,faf
  rman -f HTML $S/man/zipsplit.1 > $A/docs/zipsplit,faf
  cp $S/{BUGS,CHANGES,LICENSE,README,README.CR,TODO,WHATSNEW,WHERE,zip30.ann} $A/docs

  # No -unixlib as we're using SCL
  $AB_HOME/add-riscpkg -copyrightfile $S/LICENSE
}

