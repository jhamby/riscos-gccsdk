# This package includes the libraries specified
# in the zipprefix file.
# Ideally depends should also be updated to
# ensure the libraries are built before
# being included in this package

AB_NOREMOTE=yes
AB_ZIPNAME=libu-0.1
AB_CATEGORY=libraries

AB_MAKE=":"

# List of libraries for webinfo
libulist=""

ab_package() {
  cp -av $H/\!LibU $D

  FILES=$(cat $H/zipprefix)

  cd $D/\!LibU

  # Get list of libraries
  ls -t -1 $AB_OUTPUTLIB/*.zip > alllibraries

  for FILE in $FILES ; do
     echo "Copying library zip file prefixed $FILE"
     FULLPATH=$( grep -m 1 "$AB_OUTPUTLIB/$FILE" alllibraries )
     echo "Full path found $FULLPATH"
     unzip $FULLPATH
     if [ -e abshortdesc ] ; then
       shortdesc=$(cat abshortdesc)
       echo $shortdesc >> $D/\!LibU/\!Help
       rm -f abshortdesc
       libulist="$libulist <li>$shortdesc</li>\n"
     fi
  done

  # Need to retype the converted manual files
  echo "Filetypeing man files"
  MANFILES=$(find man -type f)
  for FILE in $MANFILES ; do
     mv $FILE $FILE,faf
  done

  rm -f alllibraries
}

# Override ab_webinfo so we can add list of libraries
# to the description
ab_webinfo() {
  . $AB_HOME/build-webinfo
  echo -e " <ul>\n$libulist </ul>\n" >> $AB_OUTPUTPACK/webinfo/$AB_ZIPNAME-$AB_ROVERSION
}
