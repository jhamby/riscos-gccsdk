Index: configure.in
===================================================================
RCS file: /cvsroot/mozilla/configure.in,v
retrieving revision 1.1503.2.108
diff -u -r1.1503.2.108 configure.in
--- configure.in	8 Nov 2007 19:13:08 -0000	1.1503.2.108
+++ configure.in	26 Dec 2007 00:43:02 -0000
@@ -1369,6 +1369,20 @@
     HOST_OPTIMIZE_FLAGS="${HOST_OPTIMIZE_FLAGS=-O2}"
     ;;
 
+*riscos*)
+    HOST_CFLAGS="$HOST_CFLAGS -DXP_UNIX"
+    HOST_OPTIMIZE_FLAGS="${HOST_OPTIMIZE_FLAGS=-O2}"
+    DSO_PIC_CFLAGS=
+    DSO_LDOPTS=
+    DLL_SUFFIX=.a
+    BIN_SUFFIX=,e1f
+    MKSHLIB="$AR rc \$@"
+    MKCSHLIB="$AR rc \$@"
+    MKSHLIB_FORCE_ALL=''
+    MKSHLIB_UNFORCE_ALL=''
+    MOZ_OPTIMIZE_FLAGS=-O2
+    ;;
+
 *)
     HOST_CFLAGS="$HOST_CFLAGS -DXP_UNIX"
     HOST_OPTIMIZE_FLAGS="${HOST_OPTIMIZE_FLAGS=-O2}"
@@ -2771,11 +2785,11 @@
     AC_DEFINE(NO_X11)
 else
     AC_DEFINE_UNQUOTED(FUNCPROTO,15)
-	XLIBS="-lX11 $XLIBS"
+	XLIBS="-lCX11 -lDesk $XLIBS -static"
 	_SAVE_LDFLAGS="$LDFLAGS"
 	LDFLAGS="$XLDFLAGS $LDFLAGS"
-	AC_CHECK_LIB(X11, XDrawLines, [X11_LIBS="-lX11"],
-		[MISSING_X="$MISSING_X -lX11"], $XLIBS)
+	AC_CHECK_LIB(CX11, XDrawLines, [X11_LIBS=""],
+		[MISSING_X="$MISSING_X "], $XLIBS)
 	AC_CHECK_LIB(Xext, XextAddDisplay, [XEXT_LIBS="-lXext"],
 		[MISSING_X="$MISSING_X -lXext"], $XLIBS)
    
@@ -3975,7 +3989,8 @@
         -o "$_DEFAULT_TOOLKIT" = "windows" \
         -o "$_DEFAULT_TOOLKIT" = "cocoa" \
         -o "$_DEFAULT_TOOLKIT" = "cairo-gtk2" \
-        -o "$_DEFAULT_TOOLKIT" = "cairo-xlib"
+        -o "$_DEFAULT_TOOLKIT" = "cairo-xlib" \
+        -o "$_DEFAULT_TOOLKIT" = "riscos" 
     then
         dnl nglayout only supports building with one toolkit,
         dnl so ignore everything after the first comma (",").
@@ -4076,6 +4091,19 @@
 	TK_LIBS='$(MOZ_XLIB_LDFLAGS) $(MOZ_CAIRO_LIBS)'
 	AC_DEFINE(MOZ_WIDGET_XLIB)
     ;;
+
+riscos)
+    MOZ_ENABLE_RISCOS=1
+    if test "$_HAVE_FREETYPE2"; then
+        MOZ_ENABLE_FREETYPE2=1
+    fi
+    MOZ_ENABLE_XPRINT=1
+    TK_CFLAGS='$(MOZ_XLIB_CFLAGS)'
+    TK_LIBS='$(MOZ_XLIB_LDFLAGS)'
+    AC_DEFINE(MOZ_WIDGET_RISCOS)
+    AC_DEFINE(XP_RISCOS)
+    ;;
+
 esac
 
 if test "$MOZ_ENABLE_XREMOTE"; then
@@ -4097,13 +4125,14 @@
     PKG_CHECK_MODULES(MOZ_GTK2, gtk+-2.0 >= 1.3.7)
 fi
 
-if test "$MOZ_ENABLE_XLIB"
+if test "$MOZ_ENABLE_XLIB" -o "$MOZ_ENABLE_RISCOS"
 then
     MOZ_XLIB_CFLAGS="$X_CFLAGS"
     MOZ_XLIB_LDFLAGS="$XLDFLAGS"
     MOZ_XLIB_LDFLAGS="$MOZ_XLIB_LDFLAGS $XEXT_LIBS $X11_LIBS"
 fi
 
+
 if test "$MOZ_ENABLE_QT"
 then
     MOZ_ARG_WITH_STRING(qtdir,
@@ -4202,7 +4231,8 @@
 if test "$MOZ_ENABLE_GTK" \
 || test "$MOZ_ENABLE_QT" \
 || test "$MOZ_ENABLE_XLIB" \
-|| test "$MOZ_ENABLE_GTK2"
+|| test "$MOZ_ENABLE_GTK2" \
+|| test "$MOZ_ENABLE_RISCOS"
 then
     AC_DEFINE(MOZ_X11)
     MOZ_X11=1
Index: config/rules.mk
===================================================================
RCS file: /cvsroot/mozilla/config/rules.mk,v
retrieving revision 3.487.2.8
diff -u -r3.487.2.8 rules.mk
--- config/rules.mk	1 Sep 2007 10:31:28 -0000	3.487.2.8
+++ config/rules.mk	26 Dec 2007 00:43:16 -0000
@@ -1018,7 +1018,11 @@
 	@for lib in $(SHARED_LIBRARY_LIBS); do $(AR_EXTRACT) $${lib}; $(CLEANUP2); done
 endif # SHARED_LIBRARY_LIBS
 endif # NO_LD_ARCHIVE_FLAGS
+ifeq ($(OS_ARCH),riscos)
+	$(MKSHLIB) $(SHLIB_LDSTARTFILE) $(OBJS) $(LOBJS) $(SUB_SHLOBJS) $(RESFILE) $(EXTRA_LIBS) $(DEF_FILE) $(SHLIB_LDENDFILE)
+else
 	$(MKSHLIB) $(SHLIB_LDSTARTFILE) $(OBJS) $(LOBJS) $(SUB_SHLOBJS) $(RESFILE) $(LDFLAGS) $(EXTRA_DSO_LDOPTS) $(OS_LIBS) $(EXTRA_LIBS) $(DEF_FILE) $(SHLIB_LDENDFILE)
+endif
 	@rm -f foodummyfilefoo $(SUB_SHLOBJS) $(DELETE_AFTER_LINK)
 else # os2 vacpp
 	$(MKSHLIB) -O:$@ -DLL -INC:_dllentry $(LDFLAGS) $(OBJS) $(LOBJS) $(EXTRA_DSO_LDOPTS) $(OS_LIBS) $(EXTRA_LIBS) $(DEF_FILE)
