# Makefile for GNU libobjc for the ARM/RISC OS GCC port
#

INCLUDES = -I . -I ./objc -I ../gcc -I ../../include -DIN_GCC -DHAVE_GTHR_PTHREADS -DIN_TARGET_LIBS -fno-strict-aliasing
objcdir=$(objdir)/gcc-$(VERSION)/libobjc/$(STAGE)/$(TRG)

$(objcdir)/%.o: %.m
	$(CROSS_COBJC) -o $@ -c $< $(CROSS_COBJCLAGS) $(INCLUDES) $(CFL)

$(objcdir)/%.o: %.c
	$(CROSS_CC) -o $@ -c $< $(CROSS_CFLAGS) $(INCLUDES) $(CFL)


OBJC_H = hash.h objc-list.h sarray.h objc.h objc-api.h \
         NXConstStr.h Object.h Protocol.h encoding.h typedstream.h \
         thr.h

OBJC_THREAD_FILE = thr-posix

# Modules that comprise the runtime library.
OBJS = $(objcdir)/archive.o \
	$(objcdir)/class.o \
	$(objcdir)/encoding.o \
	$(objcdir)/gc.o \
	$(objcdir)/hash.o \
	$(objcdir)/init.o \
	$(objcdir)/linking.o \
	$(objcdir)/misc.o \
	$(objcdir)/nil_method.o \
	$(objcdir)/NXConstStr.o \
	$(objcdir)/Object.o \
	$(objcdir)/objects.o \
	$(objcdir)/Protocol.o \
	$(objcdir)/sarray.o \
	$(objcdir)/selector.o \
	$(objcdir)/sendmsg.o \
	$(objcdir)/thr.o \
	$(objcdir)/$(OBJC_THREAD_FILE).o


all:	$(ux_gcc_bin_dir)/$(TRG)/libobjc.o \
	$(ro_gcc_bin_dir)/$(TRG)/o/libobjc

$(ux_gcc_bin_dir)/$(TRG)/libobjc.o: $(OBJS)
	$(CROSS_AR) $(CROSS_AR_FLAGS) $@ $(OBJS)

$(ro_gcc_bin_dir)/$(TRG)/o/libobjc: $(OBJS)
	$(CROSS_AR) $(CROSS_AR_FLAGS) $@ $(OBJS)

runtime-info.h:
	echo "" > tmp-runtime.m
	echo "/* This file is automatically generated */" > $@
	$(CC) $(MULTIFLAGS) -print-objc-runtime-info -S tmp-runtime.m >> $@
	rm -f tmp-runtime.m tmp-runtime.s

$(objcdir)/archive.o: archive.c
$(objcdir)/class.o: class.c
$(objcdir)/encoding.o: encoding.c
$(objcdir)/gc.o: gc.c
$(objcdir)/hash.o: hash.c
$(objcdir)/init.o: init.c
$(objcdir)/linking.o: linking.m
$(objcdir)/misc.o: misc.c
$(objcdir)/nil_method.o: nil_method.c
$(objcdir)/NXConstStr.o: NXConstStr.m
$(objcdir)/Object.o: Object.m
$(objcdir)/objects.o: objects.c
$(objcdir)/Protocol.o: Protocol.m
$(objcdir)/sarray.o: sarray.c
$(objcdir)/selector.o: selector.c
$(objcdir)/sendmsg.o: sendmsg.c runtime-info.h
$(objcdir)/thr.o: thr.c
$(objcdir)/$(OBJC_THREAD_FILE).o: $(OBJC_THREAD_FILE).c
