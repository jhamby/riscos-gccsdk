% $Id: implementation.nw 2537 2012-08-04 05:23:19Z jkoshy $
%
% The implementation itself.

\part{The Implementation}\label{part.implementation}

\chapter{Overview}\label{chap.overview}

\chapter{Protocol}\label{chap.protocol}

From the despatcher to the slave.

\begin{itemize}
\item \protocmd{BYE}{\protoarg{nbytes}}

  Terminate the session.  A human readable message providing the
  reason for termination follows.

\item \protocmd{CLOSE}{\protoarg{token} \protoarg{childfd}}

  Close a file descriptor for a running script.

\item \protocmd{CWD}{\protoarg{childfd}}

  Set the current directory for new scripts.

\item \protocmd{ENV}{\protoarg{nbytes}}

  Store a default environment for use with subsequent
  \protocmd{SCRIPT} commands.

\item \protocmd{ERROR}{\protoarg{severity} \protoarg{nbytes}}

  Receive an error message sent from the despatcher.

\item \protocmd{SCRIPT}{\protoarg{token} \protoarg{uid} \protoarg{gid} \protoarg{nbytes} \protoarg{fd}\ldots}

  Execute a script with the given privileges, while monitoring the
  specified file descriptors.

\item \protocmd{SIGNAL}{\protoarg{token} \protoarg{signal}}

  Send a signal to an executing script.

\item \protocmd{STATUS}{\protoarg{token}}

  Retrieve the status of a previously issued \protocmd{SCRIPT}
  command.

\item \protocmd{SYSINFO}{}

  Return system information.

\item \protocmd{WRITE}{\protoarg{token} \protoarg{fd} \protoarg{nbytes}}

  Write to an executing script on the specified file descriptor.
\end{itemize}

From the slave to the despatcher:

\begin{itemize}
\item \protocmd{CLOSE}{\protoarg{token} \protoarg{fd}}

  Report the closing of a file descriptor by a script.

\item \protocmd{DATA}{\protoarg{token} \protoarg{fd} \protoarg{nbytes}}

  Read data generated by a script.

\item \protocmd{ERROR}{\protoarg{args}\ldots}

  Report an error.

\item \protocmd{EXIT}{\protoarg{token} \protoarg{exittype} \protoarg{code}}

  Report a script exit.

\item \protocmd{HELLO}{\protoarg{identifier} \protoarg{version}}

  Announce presence to the despatcher.

\item \protocmd{OK}{\protoarg{args}\ldots}

  Acknowledge successful execution of a command.

\item \protocmd{SYSINFO}{\protoarg{nbytes}}

  Return system information.
\end{itemize}
